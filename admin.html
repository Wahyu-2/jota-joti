<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin Dashboard - Leaderboard 20 Sekolah</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1020;--accent:#2563eb;--muted:#94a3b8}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#071022 0%,#071626 100%);color:#e6eef8;min-height:100vh;display:flex;flex-direction:column}
    header{padding:1rem 1.25rem;display:flex;align-items:center;justify-content:space-between;gap:1rem}
    h1{font-size:1.125rem;margin:0}
    .container{width:100%;max-width:1000px;margin:0 auto;padding:1rem}
    .card{background:rgba(255,255,255,0.03);border-radius:12px;padding:1rem;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    table{width:100%;border-collapse:collapse;margin-top:0.5rem}
    td,th{padding:0.5rem;border-bottom:1px solid rgba(255,255,255,0.06)}
    input[type=text], input[type=number], input[type=password]{width:100%;padding:0.4rem;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:inherit}
    button{padding:0.5rem 0.75rem;border-radius:6px;border:0;background:var(--accent);color:white;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.1)}
    .small{font-size:0.85rem;padding:0.35rem 0.5rem}
    .muted{color:var(--muted);font-size:0.9rem}
    .actions{display:flex;gap:0.4rem;flex-wrap:wrap}
    footer{margin-top:auto;padding:1rem;text-align:center;color:var(--muted);font-size:0.85rem}

    #login-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;text-align:center}
    #admin-screen{display:none;flex-direction:column;min-height:100vh}
  </style>
</head>
<body>

  <div id="login-screen">
    <div class="card" style="max-width:320px;width:100%">
      <h2>Login Admin</h2>
      <p class="muted">Masukkan password untuk melanjutkan</p>
      <input id="password-input" type="password" placeholder="Password">
      <button id="login-btn" style="margin-top:0.75rem">Login</button>
      <p id="error-msg" style="color:#f87171;display:none;margin-top:0.5rem">Password salah!</p>
    </div>
  </div>

  <div id="admin-screen">
    <header>
      <h1>Admin Dashboard</h1>
      <a href="index.html" class="muted">‚Üê Kembali ke Leaderboard</a>
    </header>

    <main class="container">
      <section class="card">
        <div class="muted">Kelola Data Sekolah</div>
        <div class="actions" style="margin:0.75rem 0">
          <input id="add-name" type="text" placeholder="Nama sekolah">
          <input id="add-score" type="number" min="0" step="1" placeholder="Skor">
          <button id="btn-add">Tambah</button>
          <button id="btn-reset" class="ghost">Reset Default</button>
        </div>

        <table>
          <thead><tr><th>#</th><th>Nama</th><th>Skor</th><th>Aksi</th></tr></thead>
          <tbody id="table-body"></tbody>
        </table>

        <div class="actions" style="margin-top:0.75rem">
          <button id="btn-save">Simpan</button>
          <button id="btn-export" class="ghost small">Export JSON</button>
          <label class="ghost small" style="cursor:pointer;display:inline-flex;align-items:center;gap:0.5rem">
            <input id="import-file" type="file" accept="application/json" style="display:none">
            Import JSON
          </label>
          <button id="btn-clear" class="ghost small">Hapus Semua</button>
        </div>
      </section>
    </main>

    <footer>
      Halaman Admin - Data disimpan di localStorage.
    </footer>
  </div>

  <script>
    // ===== Password Protection =====
    const CORRECT_PASSWORD = "admin123"; // ubah sesuai kebutuhan

    const loginScreen = document.getElementById('login-screen');
    const adminScreen = document.getElementById('admin-screen');
    const loginBtn = document.getElementById('login-btn');
    const passwordInput = document.getElementById('password-input');
    const errorMsg = document.getElementById('error-msg');

    loginBtn.addEventListener('click',()=>{
      if(passwordInput.value===CORRECT_PASSWORD){
        loginScreen.style.display='none';
        adminScreen.style.display='flex';
      }else{
        errorMsg.style.display='block';
      }
    });

    // ===== Leaderboard CRUD Logic =====
    const STORAGE_KEY = 'leaderboard_schools_v1'
    const DEFAULT_SCHOOLS = Array.from({length:20}).map((_,i)=>({id:cryptoRandomId(),name:`Sekolah ${i+1}`,score:0}));

    let schools = load()
    const tbody = document.getElementById('table-body')

    const addName = document.getElementById('add-name')
    const addScore = document.getElementById('add-score')
    const btnAdd = document.getElementById('btn-add')
    const btnReset = document.getElementById('btn-reset')
    const btnSave = document.getElementById('btn-save')
    const btnExport = document.getElementById('btn-export')
    const importFile = document.getElementById('import-file')
    const btnClear = document.getElementById('btn-clear')

    function cryptoRandomId(){return Math.random().toString(36).slice(2,9)}

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY)
        if(!raw){localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_SCHOOLS));return structuredClone(DEFAULT_SCHOOLS)}
        return JSON.parse(raw)
      }catch(e){localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_SCHOOLS));return structuredClone(DEFAULT_SCHOOLS)}
    }

    function save(){localStorage.setItem(STORAGE_KEY, JSON.stringify(schools))}

    function render(){
      tbody.innerHTML=''
      schools.forEach((s,i)=>{
        const tr=document.createElement('tr')
        tr.innerHTML=`<td>${i+1}</td>
          <td><input data-id="${s.id}" class="edit-name" value="${escapeHtmlAttr(s.name)}"></td>
          <td><input data-id="${s.id}" class="edit-score" type="number" min="0" step="1" value="${s.score}"></td>
          <td><button data-id="${s.id}" class="ghost small btn-del">Hapus</button></td>`
        tbody.appendChild(tr)
      })
      tbody.querySelectorAll('.btn-del').forEach(b=>b.addEventListener('click',e=>{
        const id=e.currentTarget.dataset.id; schools=schools.filter(x=>x.id!==id); render()
      }))
      tbody.querySelectorAll('.edit-name').forEach(inp=>inp.addEventListener('input',e=>{
        const s=schools.find(x=>x.id===e.target.dataset.id); if(s) s.name=e.target.value
      }))
      tbody.querySelectorAll('.edit-score').forEach(inp=>inp.addEventListener('input',e=>{
        const s=schools.find(x=>x.id===e.target.dataset.id); if(s) s.score=parseInt(e.target.value)||0
      }))
    }

    function escapeHtmlAttr(s){return String(s).replace(/[&<>\"]+/g, ch=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[ch]||ch))}

    btnAdd.addEventListener('click',()=>{
      const name=addName.value.trim()||`Sekolah ${schools.length+1}`
      const score=parseInt(addScore.value)||0
      schools.push({id:cryptoRandomId(),name,score})
      addName.value=''; addScore.value=''; render()
    })

    btnReset.addEventListener('click',()=>{if(confirm('Reset ke default?')){schools=structuredClone(DEFAULT_SCHOOLS);render()}})
    btnSave.addEventListener('click',()=>{save();alert('Data disimpan')})
    btnExport.addEventListener('click',()=>{
      const blob=new Blob([JSON.stringify(schools,null,2)],{type:'application/json'})
      const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='leaderboard.json';a.click();URL.revokeObjectURL(url)
    })
    importFile.addEventListener('change',e=>{
      const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{
        try{const parsed=JSON.parse(r.result);if(!Array.isArray(parsed))throw new Error('Format salah');schools=parsed.map(x=>({id:x.id||cryptoRandomId(),name:x.name||'Unnamed',score:parseInt(x.score)||0}));render();save();alert('Import sukses')}catch(err){alert('Gagal import: '+err.message)}};r.readAsText(f)
    })
    btnClear.addEventListener('click',()=>{if(confirm('Hapus semua data?')){schools=[];render();save()}})

    render()
  </script>
</body>
</html>
